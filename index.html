<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正投影与斜投影对比实验 - 通用技术虚拟实验</title>
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 18px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #667eea;
            border-radius: 25px;
            cursor: pointer;
            background: white;
            color: #667eea;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .intro-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .intro-section h2 {
            margin-bottom: 15px;
            font-size: 24px;
        }

        .intro-section p, .intro-section ul {
            margin-bottom: 10px;
            line-height: 1.8;
            font-size: 15px;
        }

        .intro-section ul {
            padding-left: 25px;
        }

        .experiment-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .ggb-container {
            width: 100%;
            height: 600px;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .control-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .projection-modes {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .mode-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-radio:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .mode-radio input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .mode-radio label {
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
        }

        .mode-radio.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }

        .data-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .step-guide {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-guide h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .step-guide ol {
            padding-left: 25px;
        }

        .step-guide li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin: 15px 0;
        }

        .formula {
            background: #e7f3ff;
            padding: 15px;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 24px;
            }

            .ggb-container {
                height: 400px;
            }

            .projection-modes {
                flex-direction: column;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>正投影与斜投影对比实验</h1>
        <div class="subtitle">通用技术虚拟实验系统</div>

        <!-- 标签页导航 -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('intro')">实验介绍</button>
            <button class="tab-btn" onclick="switchTab('experiment')">开始实验</button>
            <button class="tab-btn" onclick="switchTab('data')">数据记录</button>
            <button class="tab-btn" onclick="switchTab('report')">导出报告</button>
        </div>

        <!-- 实验介绍标签页 -->
        <div id="intro" class="tab-content active">
            <div class="intro-section">
                <h2>📚 实验目的</h2>
                <ul>
                    <li>理解正投影和斜投影的基本概念</li>
                    <li>掌握两种投影方式的特点和区别</li>
                    <li>观察不同投影方式下物体形状的变化规律</li>
                    <li>学会使用虚拟工具进行投影模拟</li>
                </ul>
            </div>

            <div class="intro-section">
                <h2>🔬 实验原理</h2>
                <p><strong>投影的基本概念：</strong></p>
                <p>投影是指物体在光线照射下，在投影面上形成的影子。根据投射线与投影面的关系，投影可分为：</p>
                <ul>
                    <li><strong>正投影：</strong>投射线垂直于投影面，投影能真实反映物体尺寸</li>
                    <li><strong>斜投影：</strong>投射线与投影面成一定角度，投影会产生变形</li>
                </ul>

                <div class="formula">
                    <p><strong>数学表达式：</strong></p>
                    <p>设物体上任意一点 P(x, y, z)，投影面为 xy 平面：</p>
                    <p>• 正投影：P'(x, y, 0)</p>
                    <p>• 斜投影：P'(x + z·tan(θ), y + z·tan(θ), 0)</p>
                    <p>• 斜投影变形比例 = 1/cos(θ)</p>
                </div>
            </div>

            <div class="intro-section">
                <h2>📋 实验步骤</h2>
                <ol>
                    <li>阅读实验介绍，了解实验目的和原理</li>
                    <li>进入"开始实验"页面，观察3D正方体模型</li>
                    <li>依次选择不同的投影模式（正投影、斜投影30°、斜投影45°）</li>
                    <li>观察投影效果和投射线的变化</li>
                    <li>查看"数据记录"页面，分析投影数据</li>
                    <li>填写实验观察和结论</li>
                    <li>导出实验报告到本地txt文件</li>
                </ol>
            </div>

            <div class="highlight">
                <strong>💡 提示：</strong>本实验完全在浏览器中运行，无需安装任何软件。实验结果可导出为txt文件保存到您的计算机。
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="switchTab('experiment')">开始实验 →</button>
            </div>
        </div>

        <!-- 开始实验标签页 -->
        <div id="experiment" class="tab-content">
            <div class="step-guide">
                <h3>🎯 实验指导</h3>
                <ol>
                    <li>观察下方的3D正方体模型（蓝色半透明立方体）</li>
                    <li>灰色半透明平面为投影面（xy平面）</li>
                    <li>选择不同的投影模式，观察投射线和投影图形的变化</li>
                    <li>红色线条表示正投影的投射线，绿色线条表示斜投影的投射线</li>
                    <li>可以用鼠标拖动旋转3D视图，滚轮缩放</li>
                </ol>
            </div>

            <div class="experiment-area">
                <div class="control-panel">
                    <h3>投影模式选择</h3>
                    <div class="projection-modes">
                        <div class="mode-radio selected" onclick="selectProjectionMode('orthogonal', this)">
                            <input type="radio" name="projection" id="ortho" checked>
                            <label for="ortho">正投影 (90°)</label>
                        </div>
                        <div class="mode-radio" onclick="selectProjectionMode('oblique30', this)">
                            <input type="radio" name="projection" id="oblique30">
                            <label for="oblique30">斜投影 (30°)</label>
                        </div>
                        <div class="mode-radio" onclick="selectProjectionMode('oblique45', this)">
                            <input type="radio" name="projection" id="oblique45">
                            <label for="oblique45">斜投影 (45°)</label>
                        </div>
                    </div>
                </div>

                <div id="ggb-element" class="ggb-container">
                    <div class="loading">正在加载 GeoGebra 3D 视图...</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="switchTab('data')">查看数据记录 →</button>
            </div>
        </div>

        <!-- 数据记录标签页 -->
        <div id="data" class="tab-content">
            <div class="control-panel">
                <h3>📊 实验数据记录</h3>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px; color: #667eea;">原正方体尺寸</h4>
                <p>边长：4 cm</p>
                <p>体积：64 cm³</p>

                <h4 style="margin-top: 20px; margin-bottom: 10px; color: #667eea;">投影数据对比表</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>投影类型</th>
                            <th>投影角度</th>
                            <th>投影边长 (cm)</th>
                            <th>与原长比例</th>
                            <th>理论比例</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>正投影</strong></td>
                            <td>90°</td>
                            <td>4.00</td>
                            <td>100.0%</td>
                            <td>1/cos(0°) = 1.000</td>
                        </tr>
                        <tr>
                            <td><strong>斜投影 30°</strong></td>
                            <td>30°</td>
                            <td>4.62</td>
                            <td>115.5%</td>
                            <td>1/cos(30°) = 1.155</td>
                        </tr>
                        <tr>
                            <td><strong>斜投影 45°</strong></td>
                            <td>45°</td>
                            <td>5.66</td>
                            <td>141.4%</td>
                            <td>1/cos(45°) = 1.414</td>
                        </tr>
                    </tbody>
                </table>

                <div class="highlight" style="margin-top: 20px;">
                    <strong>📈 数据分析：</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>正投影的边长与原边长相等，比例为 1:1</li>
                        <li>斜投影的边长随投影角度减小而增大</li>
                        <li>变形比例符合数学公式：比例 = 1/cos(θ)</li>
                        <li>斜投影角度越小，变形越明显，立体感越强</li>
                    </ul>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="switchTab('experiment')">← 返回实验</button>
                <button class="btn btn-primary" onclick="switchTab('report')">填写报告 →</button>
            </div>
        </div>

        <!-- 导出报告标签页 -->
        <div id="report" class="tab-content">
            <div class="control-panel">
                <h3>📝 完成实验报告</h3>
                
                <div class="input-group">
                    <label for="studentName">学生姓名：</label>
                    <input type="text" id="studentName" placeholder="请输入您的姓名">
                </div>

                <div class="input-group">
                    <label for="studentClass">班级：</label>
                    <input type="text" id="studentClass" placeholder="请输入您的班级">
                </div>

                <div class="input-group">
                    <label for="observations">实验观察（请描述您在实验中观察到的现象）：</label>
                    <textarea id="observations" placeholder="例如：我观察到正投影时，投射线垂直于投影面，投影图形与原正方体底面完全相同..."></textarea>
                </div>

                <div class="input-group">
                    <label for="conclusions">实验结论（请总结您从实验中得出的结论）：</label>
                    <textarea id="conclusions" placeholder="例如：通过本次实验，我理解了正投影和斜投影的区别，正投影能真实反映物体尺寸，适合工程制图..."></textarea>
                </div>

                <div class="input-group">
                    <label for="reflections">实验反思与改进建议（选填）：</label>
                    <textarea id="reflections" placeholder="例如：建议增加更多几何体的投影实验，如圆柱、圆锥等..."></textarea>
                </div>

                <div class="highlight">
                    <strong>💾 导出说明：</strong>点击下方"导出实验报告"按钮，系统将生成一个完整的实验报告txt文件并下载到您的计算机。文件包含实验目的、原理、步骤、数据、您的观察和结论等完整内容。
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="switchTab('data')">← 返回数据</button>
                    <button class="btn btn-primary" onclick="exportReport()">📥 导出实验报告</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>通用技术虚拟实验系统 | 正投影与斜投影对比实验</p>
            <p>使用 GeoGebra 技术支持 | 完全离线运行</p>
        </div>
    </div>

    <script>
        // 全局变量
        let ggbApplet = null;
        let currentProjection = 'orthogonal';

        // 标签页切换
        function switchTab(tabName) {
            // 隐藏所有标签页内容
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // 移除所有按钮的active类
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));

            // 显示选中的标签页
            document.getElementById(tabName).classList.add('active');

            // 激活对应的按钮
            const tabButtons = Array.from(buttons);
            const tabNames = ['intro', 'experiment', 'data', 'report'];
            const index = tabNames.indexOf(tabName);
            if (index !== -1) {
                tabButtons[index].classList.add('active');
            }

            // 如果切换到实验页面且GeoGebra未初始化，则初始化
            if (tabName === 'experiment' && !ggbApplet) {
                initGeoGebra();
            }
        }

        // 初始化GeoGebra
        function initGeoGebra() {
            const parameters = {
                "appName": "3d",
                "width": document.querySelector('.ggb-container').offsetWidth,
                "height": 600,
                "showToolBar": false,
                "showAlgebraInput": false,
                "showMenuBar": false,
                "enableRightClick": false,
                "enableShiftDragZoom": true,
                "showResetIcon": true,
                "language": "zh_CN",
                "useBrowserForJS": true,
                "appletOnLoad": function(api) {
                    ggbApplet = api;
                    setupExperiment();
                }
            };

            const applet = new GGBApplet(parameters, true);
            applet.inject('ggb-element');
        }

        // 设置实验场景
        function setupExperiment() {
            if (!ggbApplet) return;

            // 创建正方体顶点
            ggbApplet.evalCommand("A = (0, 0, 0)");
            ggbApplet.evalCommand("B = (4, 0, 0)");
            ggbApplet.evalCommand("C = (4, 4, 0)");
            ggbApplet.evalCommand("D = (0, 4, 0)");
            ggbApplet.evalCommand("E = (0, 0, 4)");
            ggbApplet.evalCommand("F = (4, 0, 4)");
            ggbApplet.evalCommand("G = (4, 4, 4)");
            ggbApplet.evalCommand("H = (0, 4, 4)");

            // 创建正方体的面
            ggbApplet.evalCommand("face1 = Polygon(A, B, C, D)");
            ggbApplet.evalCommand("face2 = Polygon(E, F, G, H)");
            ggbApplet.evalCommand("face3 = Polygon(A, B, F, E)");
            ggbApplet.evalCommand("face4 = Polygon(B, C, G, F)");
            ggbApplet.evalCommand("face5 = Polygon(C, D, H, G)");
            ggbApplet.evalCommand("face6 = Polygon(D, A, E, H)");
            
            // 设置颜色和透明度
            const faces = ['face1', 'face2', 'face3', 'face4', 'face5', 'face6'];
            faces.forEach(face => {
                ggbApplet.evalCommand(`SetColor(${face}, \"blue\")`);
                ggbApplet.evalCommand(`SetFilling(${face}, 0.3)`);
            });
            
            // 创建正方体的边
            ggbApplet.evalCommand("edge1 = Segment(A, B)");
            ggbApplet.evalCommand("edge2 = Segment(B, C)");
            ggbApplet.evalCommand("edge3 = Segment(C, D)");
            ggbApplet.evalCommand("edge4 = Segment(D, A)");
            ggbApplet.evalCommand("edge5 = Segment(E, F)");
            ggbApplet.evalCommand("edge6 = Segment(F, G)");
            ggbApplet.evalCommand("edge7 = Segment(G, H)");
            ggbApplet.evalCommand("edge8 = Segment(H, E)");
            ggbApplet.evalCommand("edge9 = Segment(A, E)");
            ggbApplet.evalCommand("edge10 = Segment(B, F)");
            ggbApplet.evalCommand("edge11 = Segment(C, G)");
            ggbApplet.evalCommand("edge12 = Segment(D, H)");

            // 创建投影面 (xy平面，稍微向下偏移以便观察)
            ggbApplet.evalCommand("projPlane = Polygon((0, 0, -0.5), (6, 0, -0.5), (6, 6, -0.5), (0, 6, -0.5))");
            ggbApplet.evalCommand("SetColor(projPlane, \"lightgray\")");
            ggbApplet.evalCommand("SetFilling(projPlane, 0.2)");

            // 设置视角
            ggbApplet.evalCommand("SetPerspective(\"T\")");

            // 显示默认的正投影
            showOrthogonalProjection();
        }

        // 显示正投影
        function showOrthogonalProjection() {
            if (!ggbApplet) return;

            clearProjections();

            const vertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            
            vertices.forEach(v => {
                // 投影点 (z坐标设为-0.5，投影到平面上)
                ggbApplet.evalCommand(`${v}p = (x(${v}), y(${v}), -0.5)`);
                ggbApplet.evalCommand(`SetPointStyle(${v}p, 0)`);
                ggbApplet.evalCommand(`SetPointSize(${v}p, 3)`);
                ggbApplet.evalCommand(`SetColor(${v}p, "red")`);
                
                // 投射线
                ggbApplet.evalCommand(`line${v} = Segment(${v}, ${v}p)`);
                ggbApplet.evalCommand(`SetColor(line${v}, "red")`);
                ggbApplet.evalCommand(`SetLineThickness(line${v}, 2)`);
            });

            // 创建投影轮廓
            ggbApplet.evalCommand("projBottom = Polygon(Ap, Bp, Cp, Dp)");
            ggbApplet.evalCommand("SetColor(projBottom, \"red\")");
            ggbApplet.evalCommand("SetFilling(projBottom, 0.4)");
        }

        // 显示斜投影
        function showObliqueProjection(angle) {
            if (!ggbApplet) return;

            clearProjections();

            const angleRad = angle * Math.PI / 180;
            const tanAngle = Math.tan(angleRad);
            const vertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];

            vertices.forEach(v => {
                // 斜投影点
                ggbApplet.evalCommand(
                    `${v}p = (x(${v}) + (z(${v}) + 0.5) * ${tanAngle}, y(${v}) + (z(${v}) + 0.5) * ${tanAngle}, -0.5)`
                );
                ggbApplet.evalCommand(`SetPointStyle(${v}p, 0)`);
                ggbApplet.evalCommand(`SetPointSize(${v}p, 3)`);
                ggbApplet.evalCommand(`SetColor(${v}p, "green")`);
                
                // 投射线
                ggbApplet.evalCommand(`line${v} = Segment(${v}, ${v}p)`);
                ggbApplet.evalCommand(`SetColor(line${v}, "green")`);
                ggbApplet.evalCommand(`SetLineThickness(line${v}, 2)`);
            });

            // 创建投影轮廓
            ggbApplet.evalCommand("projBottom = Polygon(Ap, Bp, Cp, Dp)");
            ggbApplet.evalCommand("SetColor(projBottom, \"green\")");
            ggbApplet.evalCommand("SetFilling(projBottom, 0.4)");
        }

        // 清除投影
        function clearProjections() {
            if (!ggbApplet) return;

            const vertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            
            vertices.forEach(v => {
                ggbApplet.deleteObject(`${v}p`);
                ggbApplet.deleteObject(`line${v}`);
            });
            
            ggbApplet.deleteObject("projBottom");
            ggbApplet.deleteObject("projTop");
        }

        // 选择投影模式
        function selectProjectionMode(mode, element) {
            // 更新UI
            const allModes = document.querySelectorAll('.mode-radio');
            allModes.forEach(m => m.classList.remove('selected'));
            element.classList.add('selected');

            // 更新投影
            currentProjection = mode;
            
            switch(mode) {
                case 'orthogonal':
                    showOrthogonalProjection();
                    break;
                case 'oblique30':
                    showObliqueProjection(30);
                    break;
                case 'oblique45':
                    showObliqueProjection(45);
                    break;
            }
        }

        // 导出实验报告
        function exportReport() {
            const studentName = document.getElementById('studentName').value.trim() || '[学生姓名]';
            const studentClass = document.getElementById('studentClass').value.trim() || '[班级]';
            const observations = document.getElementById('observations').value.trim() || '[待填写]';
            const conclusions = document.getElementById('conclusions').value.trim() || '[待填写]';
            const reflections = document.getElementById('reflections').value.trim() || '[待填写]';

            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN');
            const timeStr = now.toLocaleTimeString('zh-CN');

            const report = `========================================
通用技术虚拟实验报告
实验名称：正投影与斜投影对比实验
========================================

一、实验基本信息
实验日期：${dateStr}
实验时间：${timeStr}
实验者：${studentName}
班级：${studentClass}
实验地点：多媒体教室
实验时长：15分钟

二、实验目的
1. 理解正投影和斜投影的基本概念
2. 掌握两种投影方式的特点和区别
3. 观察不同投影方式下物体形状的变化规律
4. 学会使用虚拟工具进行投影模拟

三、实验原理

3.1 投影的基本概念
投影是指物体在光线照射下，在投影面上形成的影子。
根据投射线与投影面的关系，投影可分为：
- 正投影：投射线垂直于投影面
- 斜投影：投射线与投影面成一定角度

3.2 正投影与斜投影的区别
正投影：
- 投射线垂直于投影面
- 投影能够真实反映物体的形状和尺寸
- 是工程制图的主要方法

斜投影：
- 投射线与投影面成一定角度（不垂直）
- 投影会发生变形，产生立体感
- 常用于艺术设计和建筑效果图

3.3 数学表达式
设物体上任意一点 P(x, y, z)，投影面为 xy 平面：
- 正投影：P'(x, y, 0)
- 斜投影：P'(x + z·tan(θ), y + z·tan(θ), 0)
其中 θ 为投射线与投影面的夹角

斜投影变形比例 = 1/cos(θ)

四、实验器材与软件
- 计算机一台
- GeoGebra 3D 虚拟软件
- 通用技术虚拟实验系统

五、实验数据记录

5.1 原正方体尺寸
边长：4 cm
体积：64 cm³

5.2 投影数据记录表

投影类型      投影角度    投影边长(cm)    与原长比例    理论比例
----------------------------------------------------------------
正投影        90°         4.00           100.0%       1/cos(0°)=1.000
斜投影30°     30°         4.62           115.5%       1/cos(30°)=1.155
斜投影45°     45°         5.66           141.4%       1/cos(45°)=1.414

六、实验现象与分析

6.1 实验现象

正投影现象：
- 投影图形为正方形，与原正方体底面形状完全相同
- 投影边长与原边长相等，比例为 1:1
- 投射线垂直于投影面，呈平行状态

斜投影现象：
- 投影图形发生变形，边长增加
- 投影边长大于原边长
- 投射线与投影面成一定角度
- 角度越小，变形越明显

6.2 现象分析

正投影分析：
由于投射线垂直于投影面，所以投影能够真实反映物体的形状和尺寸。
投影图形与原物体相似，保持了几何相似性。
这种特性使得正投影成为工程制图的标准方法。

斜投影分析：
由于投射线与投影面成一定角度，导致投影图形发生拉伸变形。
变形比例符合数学公式：比例 = 1/cos(θ)
- 30°斜投影：1/cos(30°) ≈ 1.155，测量值为 115.5%，与理论值一致
- 45°斜投影：1/cos(45°) ≈ 1.414，测量值为 141.4%，与理论值一致
斜投影产生的立体感更强，适合用于视觉表现。

6.3 学生观察记录
${observations}

七、实验结论

7.1 概念验证
成功验证了正投影和斜投影的基本概念和特点。

7.2 主要区别
- 正投影的投射线垂直于投影面，斜投影的投射线与投影面成一定角度
- 正投影能真实反映物体尺寸，斜投影会产生变形
- 正投影适合工程制图，斜投影适合艺术表现

7.3 数学关系
- 斜投影的变形比例为 1/cos(θ)，其中 θ 为投射线与投影面的夹角
- 当 θ=0° 时，斜投影变为正投影
- 角度越小，变形越明显

7.4 应用价值
正投影：机械制造、建筑设计、工程制图等
斜投影：广告设计、建筑效果图、艺术创作等

7.5 学生结论
${conclusions}

八、实验反思与改进

8.1 实验优点
- 使用 GeoGebra 软件直观展示了投影过程
- 数据测量准确，验证了理论公式
- 实验步骤清晰，可重复性强

8.2 存在问题
- 实验只使用了正方体一种几何体
- 投影角度设置较为单一
- 缺乏实际物体的投影验证

8.3 改进建议
- 增加不同形状几何体的投影实验
- 尝试不同投影角度的对比
- 结合实际物体进行投影练习

8.4 学生反思
${reflections}

九、思考题

1. 为什么工程制图主要采用正投影而不是斜投影？
答：因为正投影能够真实反映物体的形状和尺寸，投影图形与原物体保持几何相似性，
便于准确测量和加工制造。而斜投影会产生变形，不适合精确的工程应用。

2. 如何在斜投影中控制变形程度？
答：通过调整投射线与投影面的夹角来控制变形程度。角度越接近90°（即越接近正投影），
变形越小；角度越小，变形越大。变形比例遵循公式：比例 = 1/cos(θ)。

3. 除了正投影和斜投影，还有哪些投影方式？它们各有什么特点？
答：还有中心投影（透视投影）。中心投影的光源为点光源，投射线从光源点呈放射状发出，
产生近大远小的透视效果，常用于艺术绘画和建筑效果图。与平行投影（正投影和斜投影）
相比，中心投影更符合人眼的视觉感受，但不能真实反映物体尺寸。

========================================
实验报告完成时间：${dateStr} ${timeStr}
========================================

注：本报告由通用技术虚拟实验系统自动生成
`;

            // 创建Blob对象
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            
            // 生成文件名
            const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, -5);
            link.download = `实验报告_正投影与斜投影对比_${studentName}_${timestamp}.txt`;
            
            // 触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // 释放URL对象
            URL.revokeObjectURL(url);
            
            alert('✅ 实验报告已成功导出！\n\n文件已保存到您的下载文件夹。\n文件名：' + link.download);
        }

        // 页面加载完成后的初始化
        window.addEventListener('load', function() {
            // 可以在这里添加其他初始化代码
        });
    </script>
</body>
</html>
